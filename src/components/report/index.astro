---
export const prerender = true;

import Context from "@astro-utils/context/Context.astro";
import Tabs from "./tabs.astro";
import TabItem from "./tab-item.astro";
import Toc from "./toc.astro";
import Hero from "./hero.astro";

import type { Year } from "@/components/chart/data";

import Chart from "@/components/chart/chart.astro";

export interface Props {
  year: Year;
}
const { year = "2023" } = Astro.props;
const allDocs = await Astro.glob(`../../../results/**/*.mdx`);
const docs = allDocs
  .filter((file) => file.file.includes(`${year}/sections`))
  .sort((a, b) => a.frontmatter.position - b.frontmatter.position);

const headings = docs
  .map((doc) => doc.getHeadings())
  .flat()
  .filter((heading) => heading.depth <= 3);
const customComponents = {
  Chart,
  TabItem,
  Tabs
};
---

<div>
  <Hero year={year} />
</div>
<div class="lg:mx-auto flex flex-row max-w-screen-xl md:pt-10 pt-0">
  <Context year={year} test="test">
    <article class="flex-1 pt-8 w-full px-3">
      <div
        class="prose lg:pr-16 max-w-none prose-img:border prose-img:border-border
            prose-headings:font-sans prose-headings:mt-8 prose-headings:mb-4
            prose-h1:text-2xl prose-h1:font-extrabold
            prose-h2:text-xl prose-h2:font-bold
            prose-h3:text-lg prose-h3:font-semibold
            prose-a:text-primary prose-a:no-underline prose-a:hover:underline prose-a:transition-all
            prose-p:leading-relaxed
            prose-strong:font-bold prose-strong:text-foreground"
      >
        {
          docs.map((doc, index) => {
            return (
              <div>
                <div class="pb-12 md:pb-16">
                  {<doc.Content components={customComponents} />}
                </div>
                {index < docs.length - 1 && (
                  <div class="flex items-center justify-center gap-2 pt-4 pb-12">
                    <div class="w-16 h-px bg-border" />
                    <div class="w-1.5 h-1.5 bg-border" />
                    <div class="w-1.5 h-1.5 bg-border" />
                    <div class="w-1.5 h-1.5 bg-border" />
                    <div class="w-16 h-px bg-border" />
                  </div>
                )}
              </div>
            );
          })
        }
      </div>
    </article>
    <Toc items={headings} />
  </Context>
</div>

<!-- New section for playground demonstration -->
<div class="bg-muted/25 py-16 my-8">
  <div class="max-w-screen-xl mx-auto px-4">
    <h2 class="text-xl font-sans font-bold mb-8 text-center">
      Try The Interactive Playground
    </h2>
    <p class="text-center mb-8 max-w-2xl mx-auto">
      Explore and experiment with our data using our interactive playground.
      Customize charts, filter data, and gain insights on your own!
    </p>
    <div class="flex justify-center">
      <a
        href="/playground"
        class="bg-primary text-primary-foreground px-6 py-3 border-2 border-primary hover:opacity-90 transition-colors"
      >
        Launch Playground
      </a>
    </div>
  </div>
</div>
