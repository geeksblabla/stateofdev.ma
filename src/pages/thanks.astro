---
import { Image } from "astro:assets";
import { getAuth } from "firebase-admin/auth";
import tarbouch from "@/assets/tarbouch.png"; // Image is 1600x900

import BaseLayout from "@/components/layout.astro";
import SocialMediaCard from "@/components/social-media-card.astro";
import { getActiveApp } from "@/lib/firebase/server";

export const prerender = false;

const auth = getAuth(getActiveApp());

/* Check current session */
if (!Astro.cookies.has("__session")) {
  return Astro.redirect("/before-start");
}
const sessionCookie = Astro.cookies.get("__session")?.value;
if (!sessionCookie) {
  return Astro.redirect("/before-start");
}
const decodedCookie = await auth.verifySessionCookie(sessionCookie);
const user = await auth.getUser(decodedCookie.uid);

if (!user) {
  return Astro.redirect("/before-start");
}

type Post = {
  user: { name: string; handle: string };
  content: string;
  rtl: boolean;
};

const posts: Post[] = [
  {
    user: { name: "Mohammed", handle: "@med" },
    content:
      "I just participated in an eye-opening survey about the state of development in Morocco! ğŸ‡²ğŸ‡¦ğŸ’» Your insights are crucial. Take 5 minutes to share your experience ",
    rtl: false
  },
  {
    user: { name: "Youssouf", handle: "@youssouf" },
    content:
      "Calling all developers in Morocco! ğŸš€ Help shape the future of our tech industry. I just completed a survey on the state of development, and your voice matters too. Join in ",
    rtl: false
  },
  {
    user: { name: "Sarah", handle: "@sara" },
    content:
      "Want to contribute to the growth of Morocco's tech scene? ğŸŒŸ I just took part in an important survey about development in our country. It's quick, easy, and impactful. Have your say",
    rtl: false
  },
  {
    user: { name: "Mariem", handle: "@mariem" },
    content:
      "Attention Moroccan tech enthusiasts! ğŸ–¥ï¸ğŸ‡²ğŸ‡¦ Be part of a nationwide tech survey. Your experiences and opinions will help drive our industry forward. I've done my part, now it's your turn",
    rtl: false
  },
  {
    user: { name: "Ù…Ø­Ù…Ø¯ ", handle: "@mohame" },
    content:
      "Ø´Ø§Ø±ÙƒØª ÙÙ‡Ø§Ø¯ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø§Ù„Ù…Ù‡Ù… Ø¹Ù„Ù‰ ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© ÙØ§Ù„Ù…ØºØ±Ø¨!  Ø±Ø£ÙŠÙƒ Ù…Ù‡Ù… Ø¨Ø²Ø§Ù. Ø®ÙˆØ¯ 5 Ø¯Ù‚Ø§ÙŠÙ‚ ÙˆØ´Ø§Ø±Ùƒ ØªØ¬Ø±Ø¨ØªÙƒ",
    rtl: true
  },
  {
    user: { name: "ÙØ§Ø·Ù…Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡", handle: "@fatimazahra" },
    content:
      "Ù†Ø¯Ø§Ø¡ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ÙŠÙ† ÙØ§Ù„Ù…ØºØ±Ø¨! Ø³Ø§Ø¹Ø¯ÙˆÙ†Ø§ Ù†Ø´ÙƒÙ„Ùˆ Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„ØµÙ†Ø§Ø¹Ø© Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ© Ø¯ÙŠØ§Ù„Ù†Ø§. Ø£Ù†Ø§ Ø¯Ø±Øª Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ØŒ ÙˆØµÙˆØªÙƒ Ù…Ù‡Ù… Ø­ØªÙ‰ Ù†ØªØ§. Ø´Ø§Ø±Ùƒ Ù…Ø¹Ø§Ù†Ø§",
    rtl: true
  },
  {
    user: { name: "ÙŠØ§Ø³ÙŠÙ† ", handle: "@yassine" },
    content:
      "Ø¨Ø§ØºÙŠ ØªØ³Ø§Ù‡Ù… ÙÙ†Ù…Ùˆ Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„ØªÙ‚Ù†ÙŠ ÙØ§Ù„Ù…ØºØ±Ø¨ØŸ Ø£Ù†Ø§ Ø´Ø§Ø±ÙƒØª ÙÙˆØ§Ø­Ø¯ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…Ù‡Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© ÙØ¨Ù„Ø§Ø¯Ù†Ø§. Ù…Ø§ØºØ§Ø¯ÙŠØ´ ÙŠØ§Ø®Ø¯ Ù…Ù†Ùƒ Ø¨Ø²Ø§Ù Ø¯ÙŠØ§Ù„ Ø§Ù„ÙˆÙ‚ØªØŒ ÙˆØºØ§Ø¯ÙŠ ÙŠÙƒÙˆÙ† Ø¹Ù†Ø¯Ùˆ ØªØ£Ø«ÙŠØ± ÙƒØ¨ÙŠØ±. Ù‚ÙˆÙ„ Ø±Ø£ÙŠÙƒ",
    rtl: true
  },
  {
    user: { name: "Ø£Ù…ÙŠÙ†Ø© ", handle: "@amina" },
    content:
      "Ø§Ù†ØªØ¨Ø§Ù‡ Ù„Ù„Ù…Ù‡ØªÙ…ÙŠÙ† Ø¨Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ ÙØ§Ù„Ù…ØºØ±Ø¨! ÙƒÙˆÙ†Ùˆ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙˆØ·Ù†ÙŠ Ù„Ù„ØªÙ‚Ù†ÙŠØ©. Ø§Ù„ØªØ¬Ø§Ø±Ø¨ ÙˆØ§Ù„Ø¢Ø±Ø§Ø¡ Ø¯ÙŠØ§Ù„ÙƒÙ… ØºØ§Ø¯ÙŠ ÙŠØ³Ø§Ø¹Ø¯Ùˆ ÙØªØ·ÙˆÙŠØ± Ø§Ù„ØµÙ†Ø§Ø¹Ø© Ø¯ÙŠØ§Ù„Ù†Ø§. Ø£Ù†Ø§ Ø¯Ø±Øª Ø§Ù„Ù„ÙŠ Ø¹Ù„ÙŠØ§ØŒ Ø¯Ø§Ø¨Ø§ Ø¯ÙˆØ±ÙƒÙ…",
    rtl: true
  },
  {
    user: { name: "Chaimae", handle: "@chaimae" },
    content:
      "Je viens de participer Ã  une enquÃªte rÃ©vÃ©latrice sur l'Ã©tat du dÃ©veloppement au Maroc ! ğŸ‡²ğŸ‡¦ğŸ’» Vos idÃ©es sont cruciales. Prenez 5 minutes pour partager votre expÃ©rience",
    rtl: false
  },
  {
    user: { name: "Karim", handle: "@karim" },
    content:
      "Appel Ã  tous les dÃ©veloppeurs au Maroc ! ğŸš€ Aidez Ã  faÃ§onner l'avenir de notre industrie technologique. Je viens de rÃ©pondre Ã  une enquÃªte sur l'Ã©tat du dÃ©veloppement, et votre voix compte aussi. Rejoignez-nous",
    rtl: false
  },
  {
    user: { name: "Souad", handle: "@souad" },
    content:
      "Vous voulez contribuer Ã  la croissance de la scÃ¨ne tech marocaine ? ğŸŒŸ Je viens de participer Ã  une importante enquÃªte sur le dÃ©veloppement dans notre pays. C'est rapide, facile et impactant. Donnez votre avis",
    rtl: false
  },
  {
    user: { name: "Hamza", handle: "@hamza" },
    content:
      "Attention aux passionnÃ©s de technologie au Maroc ! ğŸ–¥ï¸ğŸ‡²ğŸ‡¦ Faites partie d'une enquÃªte technologique nationale. Vos expÃ©riences et opinions aideront Ã  faire avancer notre industrie. J'ai fait ma part, c'est maintenant Ã  votre tour",
    rtl: false
  }
];
---

<BaseLayout>
  <div class="max-w-screen-xl w-full mx-auto p-6 text-center">
    <Image
      src={tarbouch}
      class="lg:w-[300px] my-10 sm:w-[200px] mx-auto"
      alt="tarbouch"
    />
    <p class="mb-8 text-xl font-semibold">
      Ø§Ù„Ù„Ù‡ ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„ØµØ­Ø© <br /> ÙƒÙ†Ø´ÙƒØ±ÙˆÙƒ Ø­ÙŠØª ÙƒÙ…Ù„ØªÙŠ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹{" "}
    </p>

    <div class="mb-8">
      <div>
        <div class="mb-4 max-w-lg mx-auto font-semibold">
          <p class="mb-4">
            Ø§Ù„Ø®Ø¯Ù…Ø© ØµØ¹ÙŠØ¨Ø© Ø¯Ø±ØªÙŠÙ‡Ø§ Ø¯Ø¨Ø§ Ø¨Ù‚Ø§Øª Ø§Ù„Ø³Ù‡Ù„Ø©ØŒ Ø¨Ø§Ø´ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙŠÙƒÙˆÙ† Ù…ÙÙŠØ¯ Ø®Ø§Øµ
            ÙŠØ´Ø§Ø±Ùƒ ÙÙŠÙ‡ Ø§ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ø¯ÙŠØ§Ù„ Ø§Ù„Ù†Ø§Ø³ Ø¯ÙƒØ´ÙŠ Ø¹Ù„Ø§Ø´ Ø®ØµÙƒ ØªØ¹ÙˆÙ†Ø§ ÙˆØªØ¨Ø§Ø±ØªØ¬ÙŠ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹
            Ù…Ø¹ ØµØ­Ø§Ø¨Ùƒ
          </p>
          <p>
            ÙˆØ¬Ø¯Ù†Ø§ Ù„ÙŠÙƒ Ø´ÙŠ Ø¨Ø±ÙƒØ© Ø¯ÙŠØ§Ù„ Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª Ø¨Ø§Ø´ Ù…ØªØ¹Ø¯Ø¨(ÙŠ)Ø´ ÙÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©ØŒ Ø®ØªØ§Ø±(ÙŠ)
            ÙˆØ­Ø¯Ø© Ù…Ù†Ù‡Ù… ÙˆØ¨Ø§Ø±ØªØ§Ø¬ÙŠ
          </p>
        </div>

        <section class="mt-6 flex flex-col gap-3">
          <h2 class="text-base font-semibold">Get a copy of your answers</h2>
          <p class="text-sm text-muted-foreground">
            You can view your survey responses and download a personal PDF
            report.
          </p>
          <a
            href="/my-responses"
            class="inline-flex w-fit items-center justify-center rounded border border-border px-3 py-2 text-xs font-medium uppercase tracking-[0.16em] hover:bg-primary hover:text-primary-foreground transition-colors"
          >
            View &amp; download my report
          </a>
        </section>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
          {posts.map(post => <SocialMediaCard post={post} />)}
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  function copyContent(button: Element) {
    const content = button.getAttribute("data-content");
    if (!content) {
      console.error("Content not found in dataset");
      return;
    }
    navigator.clipboard
      .writeText(content)
      .then(() => {
        const tooltip = button.querySelector(".tooltip");
        if (tooltip) {
          tooltip.classList.remove("hidden");
          setTimeout(() => {
            tooltip.classList.add("hidden");
          }, 2000);
        }
      })
      .catch((err) => {
        console.error("Failed to copy: ", err);
      });
  }

  const copyButtons = document.querySelectorAll("[data-id=\"copyButton\"]");

  if (copyButtons) {
    copyButtons.forEach((copyButton) => {
      copyButton.addEventListener("click", () => {
        copyContent(copyButton);
      });
    });
  }
</script>
